<!DOCTYPE html>
<html>
  <head>
    <title>Promo Zoom ID - Sewa Zoom</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta version="v.1.0.1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
<style>

.kontener {
    display: table;
    margin: auto;
}
.body {
    display: table-cell;
    vertical-align: middle;
	width: 500px;
	padding: 20px;
	}

	th, td {
    padding: 3px;
	padding-left: 10px;
	text-align: left; 
    vertical-align: middle;	
	}
.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}

</style>
  </head>
  <body>

<!-- Modal -->
<div class="modal fade" id="zoominvitation" role="dialog" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" id="headerintro">Zoom Meeting Berhasil Dibuat</h5>
      </div>
      <div class="modal-body">
        <div class="mb-3">
  <textarea class="form-control" id="invitation" rows="6" readonly></textarea>
  <span id="sudahcopy" style="display:none"><i>Invitation</i> sudah disalin<br><i>Host pin</i> akan diberikan paling lambat 10 menit sebelum <i>Meeting</i> dimulai</span>
  </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="copyinvitation()" id="btn1">Copy Invitation</button>
        <button type="button" data-dismiss="modal" class="btn btn-primary" id="btn2" style="display:none">Done</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="suksescopy" role="dialog" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" id="headerintro">Sewa Zoom Promo</h5>
      </div>
      <div class="modal-body">
        <div class="mb-3">
        Url dan Meeting ID berhasil disalin
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-primary">Oke</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="hostkey" role="dialog" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" id="headerintro">Host Key</h5>
      </div>
      <div class="modal-body">
        <div class="mb-3">
        <table>
        <tr><td>Host Key:</td>
        <td><input type="text" class="form-control" id="txthostkey" readonly></td></tr>
        </table>
      </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Oke</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="modallivestream" role="dialog" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" id="headerintro">Custom Live Streaming</h5>
      </div>
      <div class="modal-body">
        <div class="mb-3">
		Live Streaming URL :<input type="text" class="form-control" id="streamingurl" placeholder="Contoh : rtmp://a.rtmp.youtube.com/live2">
		Live Streaming Key :<input type="password" class="form-control" id="streamingkey" placeholder="">
		Livestream Page URL :<input type="text" class="form-control" id="streamingpage" placeholder="Contoh : https://www.youtube.com/watch?v=uey28824">
		</td></tr>
        </table>
		<span style="color:red;display:none" id="gagalstreaming"><br>Gagal, format URL tidak tepat</span>
      </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
		<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="simpanlivestream()">Simpan</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="suksesstreaming" role="dialog" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" id="headerintro">Berhasil</h5>
      </div>
      <div class="modal-body">
        <div class="mb-3">
        Custom Live Streaming Setting berhasil diupdate
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-primary">Oke</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="togglelive" role="dialog" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" id="headerintro">Live Streaming</h5>
      </div>
      <div class="modal-body">
        <div class="mb-3">
        <span id="start" style="display:none">Apakah anda yakin ingin memulai Live Streaming?</span>
		<span id="stop" style="display:none">Apakah anda yakin ingin menghentikan Live Streaming?</span>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-secondary">Tidak</button>
		<button type="button" data-dismiss="modal" class="btn btn-primary" onclick="startstop()">Ya</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="sudahlive" role="dialog" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel" id="headerintro">Live Streaming</h5>
      </div>
      <div class="modal-body">
        <div class="mb-3">
        Cek kembali pada zoom anda. Jika status live streaming masih <i>Preparing</i> dalam waktu yang cukup lama silahkan klik Stop Live Streaming dan cek kembali Pengaturan Live Streaming.
        </div>
      </div>
      <div class="modal-footer">
		<button type="button" data-dismiss="modal" class="btn btn-primary" >Oke</button>
      </div>
    </div>
  </div>
</div>

<div class="kontener">
<div class="body">
<h1 style="text-align:center">Sewa Zoom Pro Murah</h1>
  <h3 style="text-align:center">Promo Zoom ID</h3>
  <br>

<div align="center"><h4>Detail Zoom Meeting</h4></div>
<h6>Tanggal</h6>
<input id="tgl" type="date" class="form-control" placeholder="Contoh : 2020-08-25" readonly><br>
<div class="row g-3 align-items-center">
  <div class="col-auto" style="width:50%">
	<h6>Jam</h6>
    <input id="jam" type="time" class="form-control" placeholder="Contoh : 15:00" readonly><br>
  </div>
  <div class="col-auto" style="width:50%">
	<h6>Durasi</h6>
	<div class="input-group flex-nowarp">
    <input id="durasi" type="number" class="form-control" placeholder="" readonly>
	<span class="input-group-text" id="addon-wrapping">Jam</span>
	</div><br>
  </div>
</div>
<h6>Pilihan Kapasitas <i>(Participants)</i></h6>
<table>
<tr><td>
<div class="form-check">
		<input class="form-check-input" type="radio" name="tipe" id="100" disabled>
		<label class="form-check-label" for="100">
		100
		</label>
	</div></td>
<td>
	<div class="form-check">
		<input class="form-check-input" type="radio" name="tipe" id="300" disabled>
		<label class="form-check-label" for="300">
		300
		</label>
	</div>
	</td>
<td>
	<div class="form-check">
		<input class="form-check-input" type="radio" name="tipe" id="500" disabled>
		<label class="form-check-label" for="500">
		500
		</label>
	</div>
	</td>
</tr>
</table><br>
<h6>Nama Pembuat Meeting</h6>
<input id="pengundang" type="text" class="form-control" placeholder="Contoh : Zoom Meeting" onkeydown="myFunction(event,this)" onkeyup="myFunction2(event,this)" value="Zoom" readonly><div style="font-size:85%"><i>"<span id="tekspengundang">Zoom</span> is inviting you to a scheduled Zoom meeting..."</i></div><br>
<h6>Nama Meeting <i>(Topic)</i></h6>
<input id="meeting" type="text" class="form-control"readonly><br>
<h6>Deskripsi (opsional)</i></h6>
<textarea class="form-control" id="desc" rows="3" readonly></textarea><br>
<h6>ID Meeting</i></h6>
<input id="IDmeeting" type="text" class="form-control"readonly><br>
<h6>Password Zoom Meeting</h6>
<input id="pass" type="text" class="form-control"readonly><br>
<h6>URL Meeting</h6>
<textarea class="form-control" id="url" rows="5" readonly></textarea><br>
<div align="center">
<button type="button" id="btnhostkey" class="btn btn-primary" onclick="gethostkey(this)" disabled>Host Key
</button>
<button id="loadbtnhostkey" class="btn btn-primary" type="button" style="display : none;" disabled>
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  Processing...
</button>
<br>
Hostkey dapat diakses 15 menit sebelum zoom meeting dimulai
<br><br>
<button type="button" id="livestream" class="btn btn-secondary" onclick="showlivestream()" disabled>Pengaturan Live Streaming</button>
<button id="loadstreaming" class="btn btn-secondary" type="button" style="display : none;" disabled>
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  Processing...
</button><br><br>
<button type="button" id="startstop" class="btn btn-primary" onclick="showstartstop()" disabled>Start Live Stream</button>
<button id="loadstartstop" class="btn btn-primary" type="button" style="display : none;" disabled>
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  Processing...
</button><br><br>
<div id="trial" style="display:none">
Free Trial : <span id="tgltrial"></span> <span id="jamtrial"></span>-<span id="sampaitrial"></span><br>
<button type="button" id="btnhostkeytrial" class="btn btn-secondary" onclick="gethostkey(this)" disabled>Free Trial Host Key
</button>
<button id="loadbtnhostkeytrial" class="btn btn-secondary" type="button" style="display : none;" >
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  Processing...
</button>
</div>
<table>
<tr><td>
<button type="button" id="back" class="btn btn-secondary" onclick="back()">Kembali</button>
<button id="loadback" class="btn btn-secondary" type="button" style="display : none;" disabled>
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  Processing...
</button>
</td><td>
<button type="button" id="invite" class="btn btn-secondary" onclick="invitation()">Copy URL dan Meeting ID</button>
<button id="loadinvite" class="btn btn-secondary" type="button" style="display : none;" disabled>
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  Processing...
</button>
<button type="button" id="next" class="btn btn-primary" onclick="polling()" style="display : none;">Polling</button>
<button id="load" class="btn btn-primary" type="button" style="display : none;">
  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
  Processing...
</button>
</td>
</tr>
</table>
</div>

<script>
function awal() {
var skr = new Date()
skr = skr.getTime()
if (localStorage.getItem("lihat") != null && (skr < parseInt(localStorage.getItem("expired")) || sessionStorage.getItem("baru") != null)){
sessionStorage.removeItem("baru")
if (sessionStorage.getItem("tgl") != null){
document.getElementById("tgl").value = sessionStorage.getItem("tgl")
document.getElementById("jam").value = sessionStorage.getItem("jam")
document.getElementById("durasi").value = sessionStorage.getItem("durasi")
document.getElementById("IDmeeting").value = sessionStorage.getItem("IDmeeting")
document.getElementById("url").value = sessionStorage.getItem("url")
document.getElementById("meeting").value = sessionStorage.getItem("topic")
document.getElementById("desc").value = sessionStorage.getItem("agenda")
document.getElementById("pass").value = sessionStorage.getItem("password")
document.getElementById("pengundang").value = sessionStorage.getItem("pengundang")
var tipe = sessionStorage.getItem("tipe")
document.getElementById(tipe).checked = true
var wa = sessionStorage.getItem("wa")
sessionStorage.setItem("wa",wa)
sessionStorage.setItem("IDmeeting",document.getElementById("IDmeeting").value)
var pesan = document.getElementById("jam").value.split(":")
var tanggal = document.getElementById("tgl").value.split("-")
var hour = pesan[0]
var min = pesan[1]
var now = new Date();
var hournow = now.getHours();
var minnow = now.getMinutes();
document.getElementById("tekspengundang").innerHTML = document.getElementById("pengundang").value

var reserv = new Date(tanggal[0],parseInt(tanggal[1])-1,tanggal[2],hour,min)
var reserv2 = new Date(now.getFullYear(),now.getMonth(),now.getDate(),hournow,minnow)
var n = reserv.getTime() - reserv2.getTime()
if ( n <= 900000 ) {
document.getElementById("btnhostkey").disabled = false
document.getElementById("livestream").disabled = false
}
if (sessionStorage.getItem("tgltrial")){
}
if (sessionStorage.getItem("streamingurl") != "" ){
document.getElementById("startstop").disabled = false
}
if (sessionStorage.getItem("status") == "" || sessionStorage.getItem("status") == null || sessionStorage.getItem("status") == "stop"){document.getElementById("startstop").innerText = "Start Live Streaming"}
else {
document.getElementById("startstop").innerText = "Stop Live Streaming"
document.getElementById("livestream").disabled = true}
}
else {back()}
}else {back()}
}
function gethostkey(apa){
var id = apa.getAttribute("id")
document.getElementById(id).style.display = "none"
document.getElementById("load"+id).style.display = "block"
var tipe
if (document.getElementById("100").checked == true) {tipe = "100"}
else if (document.getElementById("300").checked == true) {tipe = "300"}
else {tipe = "500"}
fetch("https://script.google.com/macros/s/AKfycbzseDMVrvnQwkFMuMVj4TxF8QyBxbgwMolnIF3UtQ/exec?action=carihostkey&data="+tipe, {
  'method' : 'get'}).then(function(response) {
    return response.text().then(function(text) {
	document.getElementById(id).style.display = "block"
	document.getElementById("load"+id).style.display = "none"
	document.getElementById("txthostkey").value = text
	var myModal = new bootstrap.Modal(document.getElementById("hostkey"), {backdrop:'static',keyboard:false});
    myModal.show();
	})})
}
function hostkeyketemu(key) {
document.getElementById("btnhostkey").style.display = "block"
document.getElementById("loadhostkey").style.display = "none"
document.getElementById("txthostkey").value = key
var myModal = new bootstrap.Modal(document.getElementById("hostkey"), {backdrop:'static',keyboard:false});
    myModal.show();
}
function konfirmasi(){
var myModal = new bootstrap.Modal(document.getElementById("konfirmasi"), {backdrop:'static',keyboard:false});
    myModal.show();
}
function back() {
document.getElementById("loadback").style.display = "block"
document.getElementById("back").style.display = "none"
if (localStorage.getItem("index") != null) {
location.href = "zoomlist.html"
}
else {location.href = "buatroom.html"}
}
function invitation() {
document.getElementById("loadinvite").style.display = "block"
document.getElementById("invite").style.display = "none"
var meetingId = document.getElementById("IDmeeting").value
var pengundang = document.getElementById("pengundang").value
if (document.getElementById("100").checked == true) {var tipe = "100"}
else if (document.getElementById("300").checked == true) {var tipe = "300"}
else  {var tipe = "500"}
var param = [meetingId,tipe,pengundang]
fetch("https://script.google.com/macros/s/AKfycbzseDMVrvnQwkFMuMVj4TxF8QyBxbgwMolnIF3UtQ/exec?action=getInvitation&data="+param, {
  'method' : 'get'}).then(function(response) {
    return response.text().then(function(text) {
	var el = document.createElement('textarea');
	el.value = text;
	document.body.appendChild(el);
	el.select();
	document.execCommand('copy');
	document.body.removeChild(el);
	var myModal = new bootstrap.Modal(document.getElementById("suksescopy"), {backdrop:'static',keyboard:false});
	myModal.show();
	document.getElementById("loadinvite").style.display = "none"
	document.getElementById("invite").style.display = "block"
	})})
}
function dapet(invitation){

}
function polling(){

google.script.run.withSuccessHandler(showinvitation).zoom([wa,meeting,desc,pass,mulai,durasi])
}
function showinvitation(e) {
document.getElementById("next").style.display = "none"
document.getElementById("invitation").value = e
var myModal = new bootstrap.Modal(document.getElementById("zoominvitation"), {backdrop:'static',keyboard:false});
    myModal.show();
sessionStorage.clear()
}
function copyinvitation() {
var el = document.createElement('textarea');
  el.value = document.getElementById("invitation").value;
  document.body.appendChild(el);
  el.select();
  document.execCommand('copy');
  document.body.removeChild(el);
}
function toast() {
var toastElList = [].slice.call(document.querySelectorAll('.toast'))
        var toastList = toastElList.map(function(toastEl) {
        // Creates an array of toasts (it only initializes them)
          return new bootstrap.Toast(toastEl) // No need for options; use the default options
        });
       toastList.forEach(toast => toast.show()); // This show them
   
        console.log(toastList); // Testing to see if it works
        }
function showlivestream(){
document.getElementById("streamingurl").value = sessionStorage.getItem("streamingurl")
document.getElementById("streamingkey").value = sessionStorage.getItem("streamingkey")
document.getElementById("streamingpage").value = sessionStorage.getItem("streamingpage")
var myModal = new bootstrap.Modal(document.getElementById("modallivestream"), {backdrop:'static',keyboard:false});
    myModal.show();
}
function simpanlivestream(){
document.getElementById("gagalstreaming").style.display = "none"
document.getElementById("livestream").style.display = "none"
document.getElementById("loadstreaming").style.display = "block"
var data =[]
data.push(sessionStorage.getItem("IDmeeting"))
data.push(sessionStorage.getItem("tipe"))
data.push(document.getElementById("streamingurl").value)
data.push(document.getElementById("streamingkey").value)
data.push(document.getElementById("streamingpage").value)
fetch("https://script.google.com/macros/s/AKfycbzseDMVrvnQwkFMuMVj4TxF8QyBxbgwMolnIF3UtQ/exec?action=livestream&data="+data, {
  'method' : 'get'}).then(function(response) {
    return response.text().then(function(text) {
	if (text == "error"){
		document.getElementById("gagalstreaming").style.display = "block"
		document.getElementById("livestream").style.display = "block"
		document.getElementById("loadstreaming").style.display = "none"
		var myModal = new bootstrap.Modal(document.getElementById("modallivestream"), {backdrop:'static',keyboard:false});
		myModal.show();
	}
	else {
	sessionStorage.setItem("streamingurl",document.getElementById("streamingurl").value)
	sessionStorage.setItem("streamingkey",document.getElementById("streamingkey").value)
	sessionStorage.setItem("streamingpage",document.getElementById("streamingpage").value)
	document.getElementById("livestream").style.display = "block"
	document.getElementById("loadstreaming").style.display = "none"
	var myModal = new bootstrap.Modal(document.getElementById("suksesstreaming"), {backdrop:'static',keyboard:false});
		myModal.show();
		document.getElementById("startstop").disabled = false
	}
	})})
}
function showstartstop(){
if (document.getElementById("startstop").innerText == "Start Live Streaming"){document.getElementById("start").style.display = "block"}
else{document.getElementById("stop").style.display = "block"}
var myModal = new bootstrap.Modal(document.getElementById("togglelive"), {});
myModal.show();
}
function startstop(){
document.getElementById("livestream").disabled = true
document.getElementById("startstop").style.display = "none"
document.getElementById("loadstartstop").style.display = "block"
document.getElementById("start").style.display = "none"
document.getElementById("stop").style.display = "none"
if (document.getElementById("startstop").innerText == "Start Live Streaming"){var status = "start"}
else{var status = "stop"}
var param = [sessionStorage.getItem("IDmeeting"),sessionStorage.getItem("tipe"),status]
fetch("https://script.google.com/macros/s/AKfycbzseDMVrvnQwkFMuMVj4TxF8QyBxbgwMolnIF3UtQ/exec?action=startstop&data="+param, {
  'method' : 'get'}).then(function(response) {
    return response.text().then(function(text) {
	if (text == "error"){
		document.getElementById("startstop").style.display = "block"
		document.getElementById("loadstartstop").style.display = "none"
		var myModal = new bootstrap.Modal(document.getElementById("gagallive"), {});
		myModal.show();
	}
	else{
		if ( status == "start"){
			document.getElementById("livestream").disabled = true
			document.getElementById("startstop").innerText = "Stop Live Streaming"
			sessionStorage.setItem("status","start")
			var myModal = new bootstrap.Modal(document.getElementById("sudahlive"), {backdrop:'static',keyboard:false});
			myModal.show()}
		else {
			document.getElementById("livestream").disabled = false
			document.getElementById("startstop").innerText = "Start Live Streaming"
			sessionStorage.setItem("status","stop")
		}
		document.getElementById("startstop").style.display = "block"
		document.getElementById("loadstartstop").style.display = "none"
	}
	})})
}
document.addEventListener("DOMContentLoaded", awal);
</script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </body>
</html>
